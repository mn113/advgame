<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Sprite Test</title>
		<style>
			div {display: inline-block;}
			.argyle_guy {
				width:40px;
				height:88px;
				background: url("game art/argyle_guy_walking.png");
				border-bottom: 2px solid #333;
			}
			.front {
				background-position: 0px 0px;
			}
			.back {
				background-position: 0px -88px;
			}
			.right {
				background-position: 0px -176px;
			}
			.right.walk {
				animation: walk-ee .9s 0s steps(8) infinite;
			}
			.left {
				background-position: 0px -176px;
			   -moz-transform: scaleX(-1);
				-o-transform: scaleX(-1);
				-webkit-transform: scaleX(-1);
				transform: scaleX(-1);
				filter: FlipH;
				-ms-filter: "FlipH";
			}
			.left.walk {
				animation: walk-ee .9s 0s steps(8) infinite;
			}
			@keyframes walk-ee {
				from { background-position: -40px -176px; }
				to   { background-position: -360px -176px; }
			}
		</style>
	</head>
	<body>
		<div class="argyle_guy front"></div>
		<div class="argyle_guy back"></div>
		<br>
		<div class="argyle_guy right"></div>
		<div class="argyle_guy right walk"></div>
		<br>
		<div class="argyle_guy left"></div>
		<div class="argyle_guy left walk"></div>
		<br>
		<img id="img1" src="ubuntu-logo.png "/>
		<img id="img2" />
		<p id="plain"></p>

		<script src="js/steganography.js"></script>
		<script>
			function getBase64Image(img) {
				// Create an empty canvas element
				var canvas = document.createElement("canvas");
				canvas.width = img.width;
				canvas.height = img.height;

				// Copy the image contents to the canvas
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img, 0, 0);

				// Get the data-URL formatted image
				// Firefox supports PNG and JPEG. You could check img.src to
				// guess the original format, but be aware the using "image/jpg"
				// will re-encode the image.
				var dataURL = canvas.toDataURL("image/png");

				canvas = null;
				return dataURL;
			}

			var plaintext = "var john = new Character($('#john'), 'John', 'lightblue').placeAt([30,160]).face(180).setZIndex();";

			// Get image data:
			var img1 = document.getElementById("img1");
			var container = getBase64Image(img1);
			console.log(container);	// OK

			// Steg functions:
			console.log(steg.getHidingCapacity(container, null));
			var	ciphertext = steg.encode(plaintext, container);
			var	decoded = steg.decode(ciphertext);

			// Load results:
			document.getElementById("img2").src = ciphertext;
			document.getElementById("plain").innerHTML = decoded;	// 192 chars

			console.log(ciphertext);
			console.log(decoded);

			// Run code:
			eval(decoded);
		</script>
	</body>
</html>
